name: Kraken Trend Alert

on:
  schedule:
    - cron: '50 0 * * *'
    - cron: '51 6 * * *'   
    - cron: '52 12 * * *'
    - cron: '53 18 * * *'
  workflow_dispatch:
  
jobs:
  send-message:
    runs-on: ubuntu-latest
    env:
      TELEGRAM_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
      TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      TZ: Africa/Lagos  # Set your timezone here
    steps:
      - name: Send Telegram message based on time
        run: |
          CURRENT_HOUR=$(date +'%H')
          echo "Current hour: $CURRENT_HOUR"

          if [ "$CURRENT_HOUR" -ge 0 ] && [ "$CURRENT_HOUR" -lt 9 ]; then
            MESSAGE="Good morning! ‚òÄÔ∏è Have a great day!"
          elif [ "$CURRENT_HOUR" -ge 18 ] && [ "$CURRENT_HOUR" -lt 24 ]; then
            MESSAGE="Good night! üåô Sleep well!"
          else
            echo "No message to send at this hour."
            exit 0
          fi

          echo "Sending message: $MESSAGE"

          curl -s -X POST "https://api.telegram.org/bot${TELEGRAM_BOT_TOKEN}/sendMessage" \
            -d chat_id="${TELEGRAM_CHAT_ID}" \
            -d text="${MESSAGE}"

  check_ma_crossover:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ccxt requests pandas

      - name: Download Python script
        run: curl -o checker.py ${{ secrets.CHECKER }}

      - name: Verify script download
        run: head -n 10 checker.py

      - name: Print current UTC time
        run: date -u

      - name: Run MA crossover check
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: python checker.py
